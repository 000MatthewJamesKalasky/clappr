!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Clappr"),require("shaka")):"function"==typeof define&&define.amd?define(["Clappr","shaka"],t):"object"==typeof exports?exports.DashShakaPlayback=t(require("Clappr"),require("shaka")):e.DashShakaPlayback=t(e.Clappr,e.shaka)}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function(e,t,r){for(var n=!0;n;){var i=e,a=t,o=r;n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,a);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(o)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=a,r=o,n=!0,s=l=void 0}},u=r(1),l=r(2),h=n(l),c=3e4,f=-1,y=function(e){function t(e){i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._levels=[],e.autoPlay&&this.play()}return a(t,e),o(t,[{key:"name",get:function(){return"DashShakaPlayback"}},{key:"shakaVersion",get:function(){return h.default.player.Player.version}},{key:"shakaPlayerInstance",get:function(){return this._player}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(e){var t=this;this._currentLevelId=e;var r=this._currentLevelId===f;this._player.configure({abr:{enable:!r}}),this.trigger(u.Events.PLAYBACK_LEVEL_SWITCH_START),r||this.selectTrack(this.videoTracks.filter(function(e){return e.id===t._currentLevelId})[0]),this.trigger(u.Events.PLAYBACK_LEVEL_SWITCH_END)},get:function(){return this._currentLevelId||f}}],[{key:"canPlay",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];h.default.polyfill.installAll();var r=h.default.Player.isBrowserSupported(),n=e.split("?")[0].match(/.*\.(.*)$/)||[];return r&&("mpd"===n[1]||t.indexOf("application/dash+xml")>-1)}},{key:"Events",get:function(){return{SHAKA_READY:"shaka:ready"}}}]),o(t,[{key:"play",value:function(){return this._player||this._setup(),this.isReady?(this._src=this.el.src,void s(Object.getPrototypeOf(t.prototype),"play",this).call(this)):void this.once(t.Events.SHAKA_READY,this.play)}},{key:"setupSrc",value:function(){}},{key:"_ready",value:function(){}},{key:"error",value:function(e){u.Log.error("an error was raised by the video tag",e,this.el.error)}},{key:"isHighDefinitionInUse",value:function(){return!!this.highDefinition}},{key:"stop",value:function(){var e=this;clearInterval(this.sendStatsId),this._sendStats(),this._player.unload().then(function(){s(Object.getPrototypeOf(t.prototype),"stop",e).call(e),e._player=null,e._isShakaReadyState=!1}).catch(function(){u.Log.error("shaka could not be unloaded")})}},{key:"getPlaybackType",value:function(){return(this._player&&this._player.isLive()?"live":"vod")||""}},{key:"selectTrack",value:function(e){this._player.selectTrack(e),this._onAdaptation()}},{key:"destroy",value:function(){var e=this;clearInterval(this.sendStatsId),this._player?this._destroy():this._player.destroy().then(function(){return e._destroy()}).catch(function(){e._destroy(),u.Log.error("shaka could not be destroyed")})}},{key:"_setup",value:function(){var e=this;this._isShakaReadyState=!1,this._player=this._createPlayer(),this._options.shakaConfiguration&&this._player.configure(this._options.shakaConfiguration),this._options.shakaOnBeforeLoad&&this._options.shakaOnBeforeLoad(this._player);var t=this._player.load(this._options.src);t.then(function(){return e._loaded()}).catch(function(t){return e._setupError(t)})}},{key:"_createPlayer",value:function(){var e=new h.default.Player(this.el);return e.addEventListener("error",this._onError),e.addEventListener("adaptation",this._onAdaptation),e.addEventListener("buffering",this._onBuffering),e}},{key:"_onBuffering",value:function(e){var t=e.buffering?u.Events.PLAYBACK_BUFFERING:u.Events.PLAYBACK_BUFFERFULL;this.trigger(t)}},{key:"_loaded",value:function(){this._isShakaReadyState=!0,this.trigger(t.Events.SHAKA_READY),this._shakaReady(),this._startToSendStats(),this._fillLevels()}},{key:"_fillLevels",value:function(){0===this._levels.length&&(this._levels=this.videoTracks.map(function(e){return{id:e.id,label:e.height+"p"}}).reverse(),this.trigger(u.Events.PLAYBACK_LEVELS_AVAILABLE,this.levels))}},{key:"_startToSendStats",value:function(){var e=this,t=this._options.shakaSendStatsInterval||c;this.sendStatsId=setInterval(function(){return e._sendStats()},t)}},{key:"_sendStats",value:function(){this.trigger(u.Events.PLAYBACK_STATS_ADD,this._player.getStats())}},{key:"_setupError",value:function(e){this._onError(e)}},{key:"_onError",value:function(e){u.Log.error("Shaka error event:",e),this.trigger(u.Events.PLAYBACK_ERROR,e,this.name)}},{key:"_onAdaptation",value:function(){var e=this.videoTracks.filter(function(e){return e.active===!0})[0];this._fillLevels(),u.Log.debug("an adaptation has happened:",e),this.highDefinition=e.height>=720,this.trigger(u.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(u.Events.PLAYBACK_BITRATE,{bandwidth:e.bandwidth,width:e.width,height:e.height,level:e.id})}},{key:"_destroy",value:function(){s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this._isShakaReadyState=!1,u.Log.debug("shaka was destroyed")}},{key:"_shakaReady",value:function(){s(Object.getPrototypeOf(t.prototype),"_ready",this).call(this)}},{key:"isReady",get:function(){return this._isShakaReadyState}},{key:"textTracks",get:function(){return this._player&&this._player.getTracks().filter(function(e){return"text"===e.type})}},{key:"audioTracks",get:function(){return this._player&&this._player.getTracks().filter(function(e){return"audio"===e.type})}},{key:"videoTracks",get:function(){return this._player&&this._player.getTracks().filter(function(e){return"video"===e.type})}}]),t}(u.HTML5Video);t.default=y,e.exports=t.default},function(t,r){t.exports=e},function(e,r){e.exports=t}])});
//# sourceMappingURL=dash-shaka-playback.min.js.map