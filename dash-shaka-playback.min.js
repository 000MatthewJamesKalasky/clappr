!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DashShakaPlayback=e():t.DashShakaPlayback=e()}(this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function(t,e,r){for(var i=!0;i;){var n=t,a=e,o=r;i=!1,null===n&&(n=Function.prototype);var s=Object.getOwnPropertyDescriptor(n,a);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(o)}var u=Object.getPrototypeOf(n);if(null===u)return;t=u,e=a,r=o,i=!0,s=u=void 0}},o=window.Clappr,s=o.HTML5Video,l=o.Log,u=o.Events,h=window.shaka,c=3e4,y=-1,f=function(t){function e(t){r(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this._levels=[],t.autoPlay&&this.play()}return i(e,t),n(e,[{key:"name",get:function(){return"DashShakaPlayback"}},{key:"shakaVersion",get:function(){return h.player.Player.version}},{key:"shakaPlayerInstance",get:function(){return this._player}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(t){var e=this;this._currentLevelId=t;var r=this._currentLevelId===y;this._player.configure({abr:{enable:!r}}),this.trigger(u.PLAYBACK_LEVEL_SWITCH_START),r||this.selectTrack(this.videoTracks.filter(function(t){return t.id===e._currentLevelId})[0]),this.trigger(u.PLAYBACK_LEVEL_SWITCH_END)},get:function(){return this._currentLevelId||y}}],[{key:"canPlay",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];h.polyfill.installAll();var r=h.Player.isBrowserSupported(),i=t.split("?")[0].match(/.*\.(.*)$/)||[];return r&&("mpd"===i[1]||e.indexOf("application/dash+xml")>-1)}},{key:"Events",get:function(){return{SHAKA_READY:"shaka:ready"}}}]),n(e,[{key:"play",value:function(){return this._player||this._setup(),this.isReady?(this._src=this.el.src,void a(Object.getPrototypeOf(e.prototype),"play",this).call(this)):void this.once(e.Events.SHAKA_READY,this.play)}},{key:"setupSrc",value:function(){}},{key:"_ready",value:function(){}},{key:"error",value:function(t){l.error("an error was raised by the video tag",t,this.el.error)}},{key:"isHighDefinitionInUse",value:function(){return!!this.highDefinition}},{key:"stop",value:function(){var t=this;clearInterval(this.sendStatsId),this._sendStats(),this._player.unload().then(function(){a(Object.getPrototypeOf(e.prototype),"stop",t).call(t),t._player=null,t._isShakaReadyState=!1}).catch(function(){l.error("shaka could not be unloaded")})}},{key:"getPlaybackType",value:function(){return(this._player&&this._player.isLive()?"live":"vod")||""}},{key:"selectTrack",value:function(t){this._player.selectTrack(t),this._onAdaptation()}},{key:"destroy",value:function(){var t=this;clearInterval(this.sendStatsId),this._player?this._destroy():this._player.destroy().then(function(){return t._destroy()}).catch(function(){t._destroy(),l.error("shaka could not be destroyed")})}},{key:"_setup",value:function(){var t=this;this._isShakaReadyState=!1,this._player=this._createPlayer(),this._options.shakaConfiguration&&this._player.configure(this._options.shakaConfiguration),this._options.shakaOnBeforeLoad&&this._options.shakaOnBeforeLoad(this._player);var e=this._player.load(this._options.src);e.then(function(){return t._loaded()}).catch(function(e){return t._setupError(e)})}},{key:"_createPlayer",value:function(){var t=new h.Player(this.el);return t.addEventListener("error",this._onError),t.addEventListener("adaptation",this._onAdaptation),t.addEventListener("buffering",this._onBuffering),t}},{key:"_onBuffering",value:function(t){var e=t.buffering?u.PLAYBACK_BUFFERING:u.PLAYBACK_BUFFERFULL;this.trigger(e)}},{key:"_loaded",value:function(){this._isShakaReadyState=!0,this.trigger(e.Events.SHAKA_READY),this._shakaReady(),this._startToSendStats(),this._fillLevels()}},{key:"_fillLevels",value:function(){0===this._levels.length&&(this._levels=this.videoTracks.map(function(t){return{id:t.id,label:t.height+"p"}}).reverse(),this.trigger(u.PLAYBACK_LEVELS_AVAILABLE,this.levels))}},{key:"_startToSendStats",value:function(){var t=this;this.sendStatsId=setInterval(function(){return t._sendStats()},c)}},{key:"_sendStats",value:function(){this.trigger(u.PLAYBACK_STATS_ADD,this._player.getStats())}},{key:"_setupError",value:function(t){this._onError(t)}},{key:"_onError",value:function(t){l.error("Shaka error event:",t),this.trigger(u.PLAYBACK_ERROR,t,this.name)}},{key:"_onAdaptation",value:function(){var t=this.videoTracks.filter(function(t){return t.active===!0})[0];this._fillLevels(),l.debug("an adaptation has happened:",t),this.highDefinition=t.height>=720,this.trigger(u.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(u.PLAYBACK_BITRATE,{bandwidth:t.bandwidth,width:t.width,height:t.height,level:t.id})}},{key:"_destroy",value:function(){a(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._isShakaReadyState=!1,l.debug("shaka was destroyed")}},{key:"_shakaReady",value:function(){a(Object.getPrototypeOf(e.prototype),"_ready",this).call(this)}},{key:"isReady",get:function(){return this._isShakaReadyState}},{key:"textTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"text"===t.type})}},{key:"audioTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"audio"===t.type})}},{key:"videoTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"video"===t.type})}}]),e}(s);e.default=f,t.exports=e.default}])});